<p align="center">
    <img src="https://thecodingmachine.github.io/symfony-boilerplate/img/logo.svg" alt="Symfony Boilerplate" width="250" height="250" />
</p>
<h3 align="center">Symfony Boilerplate</h3>
<p align="center"><a href="https://thecodingmachine.github.io/symfony-boilerplate">Documentation</a></p>


# TOConline integration

A web application built with Nuxt.js, Symfony 5, and GraphQL that integrates with TOConline API.

## Setup

### Prerequisites

#### Linux

Install the latest version of [Docker](https://docs.docker.com/install/) and 
[Docker Compose](https://docs.docker.com/compose/install/).

### Hosts

Update your `hosts` file with the following entries:

```
127.0.0.1   traefik.toconline-integration.localhost
127.0.0.1   toconline-integration.localhost
127.0.0.1   api.toconline-integration.localhost
127.0.0.1   phpmyadmin.toconline-integration.localhost
127.0.0.1   minio.toconline-integration.localhost
127.0.0.1   mailhog.toconline-integration.localhost
```

Run `sudo nano /etc/hosts` to edit it.

### First start

Copy the file [.env.dist](.env.dist) to a file named `.env`. For instance:

```
cp .env.dist .env
```

> Edit the [.env.dist](.env.dist) by updating the default values of `DOMAIN`, `MYSQL_DATABASE` and `APP_SECRET`
> environment variables.

---

Next, run:

```
docker-compose up webapp api
```

ðŸ“£&nbsp;&nbsp;This command start the `webapp` and `api` service. While booting, these services install the JavaScript
and PHP dependencies.

Once the services have installed the dependencies, you may stop them with:

```
CTRL+C
docker-compose down
```

Next, check there is no application running on port 80 (like Apache or another virtual machine).

---

Next, make sure there is no application running on port 80.

Good? You may now start all the Docker containers with the following commands:

```
make up
```

It may take some time as each container will also set up itself, such as installing dependencies (PHP, JavaScript, etc.), 
compiling sources (JavaScript), or running migrations to set up the database structure.

**ðŸ“£&nbsp;&nbsp;In some cases, the `api` service will try to run the migrations before the `mysql` service is ready. 
If so, restart the `api` service with `docker-compose up -d api`.**

The containers will be ready faster next time you run this command as the first run is doing most of the setup.

Once everything is ready, the following endpoints should be available:

* http://traefik.toconline-integration.localhost (Reverse proxy, the entry point of all the HTTP requests)
* http://toconline-integration.localhost (Web application)
* http://api.toconline-integration.localhost (API)
* http://phpmyadmin.toconline-integration.localhost (phpMyAdmin, a web interface for your MySQL database)
* http://minio.toconline-integration.localhost (S3 compatible storage)
* http://mailhog.toconline-integration.localhost (Emails catcher)

> Update the domain with the one used in your project.

You may now enter the `api` service and load the development data:

```
make api
php bin/console app:fixtures:dev
exit
```

**Last but not least, start the message consumer with:**
 
```
make consume
```

## What's next?

### Configuring Git

It would be best if you ignored globally some folders like those generated by your IDE.

If not already done, you need to tell Git where to find your global `.gitignore` file.

For instance, on Linux git bash:

```
git config --global core.excludesfile '~/.gitignore'
```


Then create the global `.gitignore` file according to the location specified previously.

You may now edit it, according to your environment, with:

```
# IDE
.idea
```

### Documentations

Make sure you have read the following documentations:

**Day-to-day guidelines**

* [Web application guidelines](src/webapp/README.md)
* [API guidelines](src/api/README.md)

**In-depth explanations**

* See [docs](docs) folder.

### How to view the logs of the Docker containers?

All aggregated logs:

```
docker-compose logs -f
```

Logs of one service:

```
docker-compose logs -f SERVICE_NAME
```

For instance, if you want the logs of the `api` service:

```
docker-compose logs -f api
```
